<% provide(:title, "Feedback Requests") %>

<h1>Feedback Requests</h1>
<h2>New Invitations</h2>

<div class="form-container">
<table id="invitations">
  <thead>
    <tr>
      <th>Reviewee</th>
      <th>Review Type</th>
      <th>Invite Sent</th>
      <th>Feedback Deadline</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @invitations.each do |invitation| %>
      <% review = invitation.review %>
      <tr>
        <td><%= review.associate_consultant %></td>
        <td><%= review.review_type %></td>
        <td><%= invitation.sent_date %></td>
        <td><%= review.feedback_deadline %></td>
        <td class="nowrap button-col">
          <ul>
            <li>
              <%= link_to "", new_review_feedback_path(review),
                class: "fa fa-play fa-lg fa-fw" %>
            </li>
            <li>
              <%= link_to "",
                review_invitation_path(review, invitation),
                class: "fa fa-trash fa-lg fa-fw",
                method: :delete,
                confirm: "Are you sure you want to decline "\
                  "#{review.associate_consultant}'s feedback invitation?'"%>
            </li>
          </ul>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
</div>

<br>
<h2>Unfinished Feedback</h2>

<div class="form-container">
<table id="feedbacks">
  <thead>
    <tr>
      <th>Reviewee</th>
      <th>Review Type</th>
      <th>Project</th>
      <th>Updated</th>
      <th>Deadline</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @feedbacks.includes(:review, {:review => :associate_consultant}).each do |feedback| %>
      <% review = feedback.review %>

      <tr>
        <td><%= review.associate_consultant %></td>
        <td><%= review.review_type %></td>
        <td><%= feedback.project_worked_on %></td>
        <td><%= feedback.updated_at.to_date %></td>
        <td><%= review.feedback_deadline %></td>
        <td class="nowrap button-col"><%= link_to "", edit_review_feedback_path(review, feedback), class: "fa fa-pencil fa-lg fa-fw" %></td>
      </tr>
    <% end %>
  </tbody>
</table>
</div>

<br>
<h2>Completed Feedback</h2>

<div class="form-container">
<table id="completeds">
  <thead>
    <tr>
      <th>Reviewee</th>
      <th>Review Type</th>
      <th>Project</th>
      <th>Date Finished</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @completeds.includes(:review, {:review => :associate_consultant}).each do |completed| %>
      <% review = completed.review %>

      <tr>
        <td><%= review.associate_consultant %></td>
        <td><%= review.review_type %></td>
        <td><%= completed.project_worked_on %></td>
        <td><%= completed.updated_at.to_date %></td>
        <td class="nowrap button-col">
          <%= link_to "",
            review_feedback_path(review, completed), class: "fa fa-eye fa-lg fa-fw" %><br>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
</div>

<br class="spacer" />
<br class="spacer" />

<script>
  $('#feedbacks').dataTable({
    bPaginate: false,
    bInfo: false,
    bFilter: false,
    bLengthChange: false,
    aoColumnDefs: [
      { bSortable: false, aTargets: [5] }
    ]
  });
</script>

<script>
  $('#invitations').dataTable({
    bPaginate: false,
    bInfo: false,
    bFilter: false,
    bLengthChange: false,
    aoColumnDefs: [
      { bSortable: false, aTargets: [4] }
    ]
  });
</script>

<script>
  $('#completeds').dataTable({
    bPaginate: false,
    bInfo: false,
    bFilter: false,
    bLengthChange: false,
    aoColumnDefs: [
      { bSortable: false, aTargets: [4] }
    ]
  });
</script>
